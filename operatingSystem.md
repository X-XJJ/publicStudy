# 相关其他
## java内存池
- 一般的系统接口申请内存：
- C/C++ malloc/free
- java new/delete
- 在内存碎片中寻找最接近申请大小的内存块，返给申请者，容易造成众多小块内存碎片无法利用
- 内存池：
  - 定长分配，每次分配固定长度
  - 变长分配
- 定长分配：每次申请固定长度，使用时利用栈，例如存储一个变量，申请malloc内存，便入栈一个，直到这个长度的内存使用完毕，再一次申请定长内存；free即出栈


# 基本概念
- 计算机系统划分：硬件 →操作系统 →应用程序 →用户（与计组分层不同）
- 操作系统 Operating System，是一种系统软件，如Windows，Linux
- 特征：并发，共享，虚拟，异步
  - 并发-最基本：同一时间间隔Δt内存在多个运行的程序（并行：同一时刻，需相关硬件才行）
    - 为此引入“进程”，并通过分时实现并发
  - 共享-最基本：即资源共享，系统资源可供内存中多个并发执行的进程共同使用
    - 互斥共享：一段时间内只允许一个进程访问，如打印机、磁带机
    - 同时访问：宏观同时访问；微观交替访问、分时共享、一个请求分几个时间片间隔完成
  - 虚拟：一个物理上的实体变为若干个逻辑上的对应物
    - 时分复用技术：处理器的分时共享
    - 空分复用技术
      - 虚拟处理器：一个物理CPU虚拟为多个逻辑上的CPU，分别服务多个不同的用户
      - 虚拟存储器：一个物理存储器转为虚拟存储器，从逻辑上扩充存储器的虚拟容量
  - 异步：进程的执行走走停停，以不可预知的速度向前推进
- 功能
  - 管理计算机系统资源：处理器管理，存储器管理，文件管理，设备管理（如IO）
  - 是用户与硬件的接口：命令接口-联机交互式/脱机批处理式，程序接口，UI（本质是程序）接口
  - 计算机扩展
- 发展：批处理OS-单道/多道，分时OS，实时OS-硬实时/软实时，分布式OS，网络OS，嵌入式OS
- OS状态：用户态，核心态
- 核心态：状态切换 + 内核
  - 状态切换-系统调用
    - 设备管理，文件管理，进程通信，进程控制，内存管理
    - 系统调用-用户态，执行-内核态，最后返回用户态
  - 内核
    - 时钟管理，中断机制，原语-不可中断
    - 系统控制的数据结构 + 处理：进程管理，存储器管理，设备管理
- 硬件实现中断 + 异常
  - 中断-被动进入，异常-主动进入or系统调度
  - 硬件实现中断和异常，是唯一从用户态进入核心态的途径
- 体系结构：大内核，微内核
- 计算CUP利用率

# 进程管理
- 进程：系统拥有资源的最小单位
  - 动态，唯一标志-进程控制块PCB Process-Control-Block
  - 特征：动态，并发，独立，异步，结构 = PCB + 程序段 + 数据段
- 进程状态切换
  - 五状态模型：创建 →就绪 →等待/阻塞 →运行 →删除
  - 七状态模型：就绪挂起，阻塞挂起
- 线程：系统独立调度的基本单位
  - 实现：用户型，内核型，混合型
  - 多线程模型：一对一，一对多，多对多
- 进程间通信：共享存储，消息传递-直接通信/间接通信，管道通信，IPC
## 处理机调度（CPU调度）
- CPU周期：
- 比较准则：最大化CPU使用率+吞吐量，最小化三个时间
  - CPU使用率
  - 吞吐量
  - 周转时间
  - 等待时间
  - 响应时间
  - 平均等待时间 = (总周转 - 总执行) / 完成的进程数
- 调度方式：抢占/剥夺，非抢占/非剥夺
- 抢占式调度：先来先服务，短作业优先，
- 非抢占式调度：最短剩余时间，优先级调度，轮转调度，
- 三级调度
  - 低级调度：进程调度，频率最高
  - 中级调度：进程挂起，频率次高
  - 高级调度：作业调度，频率最低
### CPU调度算法？？进程调度算法？？
- 先来先服务 FCFS，First-Come-First-Serve
  - 不可剥夺，公平，适用短进程，IO进程不友好
  - FIFO队列实现，性能受进程时间+到来顺序影响大
  - 问题：护航效应，允许大进程长期占用CPU时间，其他进程都在等
- 短作业优先 SJF ，Shortest-Job-First
  - 优先CPU周期（执行时间）最短的，最短/最优平均等待时间
  - 问题：长进程饥饿，无法准确获取CPU周期，使用指数平均方法预测
- 最短剩余时间算法 SRTF，Shortest-Remain-Time-First scheduling
  - 允许抢占的SJF
  - 就绪队列进程的剩余执行时间比正在执行的进程的短，就抢占
- 优先级调度算法 Priority scheduling
  - 赋予每个进程动态or静态优先级，优先级最高的先执行
  - 问题：低优先级无穷阻塞/饥饿
  - 解决：老化思想，逐渐增加等待时间长的进程的优先级
- 轮转调度算法 RR，Round-Robin scheduling？？时间片调度？？
  - 就绪队列为FIFO，执行队首进程，在Δt内没完就超时中断，放到就绪队列队尾
  - 时间片Δt通常大小 = 10~100ms，时间片的选取和RR效率挂钩
  - 实时性好，利于交互，进程切换开销大
- 最高相应比优先调度算法 
  - 改进的SJF
  - 不会饥饿，计算开销大
- 多级队列调度 Multilevel-Queue
- 多级反馈队列 Multilevel-Feedback-Queue
  - 综合性强，不同长度时间片队列
  - 问题：可能饥饿
- 睡眠排序是根据哪个cpu调度算法？？
## 进程同步、互斥
- 起因：多道OS进程的异步性 + 临界资源的互斥访问
  - 同步-直接制约，互斥-间接制约
  - 空闲让进，忙则等待，有限等待，让权等待
- 软件实现：Peterson算法，flag解决临界区的互斥访问，turn解决饥饿现象
- 硬件实现：中断屏蔽，硬件指令-硬件逻辑直接实现 TestAndSet指令 + Swap指令
- 信号量同步机制-PV操作
  - P = wait(S) 阻塞原语，申请资源，信号量-1，Proberen（测试，荷兰语）
  - V = signal(S) 唤醒原语，释放资源，信号量+1，Verhogen（增加，荷兰语）
  - 进程互斥实现：两个同信号量进程都夹PV中间
  - 进程同步实现：一个进程P放顶部，对应另一进程底部同信号量V
  - 进程前趋关系：利用前趋关系图，类比同步
- PV操作问题们
  - 信号量值的隐含信息：＞0 可用资源个数，=0 该资源用完，＜0 等待进程个数
  - 互斥访问变量 Semaphore，P总数 = V总数
  - 生产者消费者问题：full empty mutex，缓冲区互斥、监视缓冲区情况
  - 读写者问题：读者不互斥-添加循环
  - 吸烟者问题：
  - 哲学家就餐问题：防止死锁
- 管程：linux中，HORE管理-A等B执行，MESA管理-B等A执行
- 自旋锁
## 程序出错
- 死锁：所有进程阻塞？
  - 充要条件：互斥，不可剥夺，请求保持，循环等待
- 解决死锁
  - 预防：发生前，破坏死锁产生的条件
  - 避免：发生前
    - MOOC中三角平面图：
    - 银行家算法
      - 安全状态：可避免死锁
      - 不安全状态：死锁必为不安全状态，不安全状态必定但非理科进入死锁
  - 检测：发生时，进程资源分配图
  - 解除：资源剥夺，撤销进程，进程回退
- 活锁：进程正常调度，不阻塞，无进展，eg无意义地一直while循环
- 饥饿：调度策略导致，某个进程一直阻塞

# 内存管理
- 功能：内存空间的分配和回收，地址转换，内存空间扩充，存储保护
- 程序执行过程：编译 →链接 →装入
  - 编译：产生若干个目标模块 + 其自身的逻辑地址
  - 链接：形成整体逻辑地址 = ｛静态链接，装入时动态链接，运行时动态链接｝
  - 装入
    - 绝对装入：连续，物理地址 = 虚拟地址
    - 可重定位装入：连续，静态重定位，一次性全装入
    - 动态运行时装入：可离散，动态重定位，进程使用时现装入，使用重定位寄存器
- 内存保护
  - 越界保护：越界中断
  - 上下限寄存器
  - 基址、限长寄存器：与限长寄存器比较，与基址寄存器相加
- 覆盖：用户空间分层固定区和覆盖区，基本不用
- 交换：与中级调度相关，不同进程or作业之间进行，广泛使用
- 工作集 = 驻留集：某段时间间隔内，进程要访问的页面集合
- 地址重定位，地址翻译，高位地位，表示的进制？？
- 访存时间，考虑块表 + 缺页中断
## 内存分配
- 连续分配
  - 单一连续分配：只适用于单用户
  - 固定分区分配：会产生内碎片，分区大小相等or不等
  - 动态分区分配：666？？
    - 分配算法：首次适应，最佳适应，最坏适应，临近适应
    - 外部碎片处理：紧凑技术
  - 伙伴分配：对半分 + 合并，最合适大小 (2^n)-1 ＜ x ＜ 2^n
- 非连续分配
  - 管理元素
    - 页表项 = 页号 + 对应块号
    - 页表 = 页表项的集合
    - 逻辑地质结构 = 页号 + 页内偏移量
    - 单位大小：页，页框，块
    - 块表TLB：联想寄存器，基于局部性原理
  - 基本分页存储管理：有内碎片，单级页表，多级页表-最顶级页表只能有一页
  - 基本分段存储管理：有外碎片，段表-二维，依逻辑分段，段内连续，段间不连续
  - 段页式存储：段表页表结合，一个进程只有一个段表，可有多个页表
## 虚拟内存管理
- 虚拟内存：逻辑上扩充内存，基于局部性原理
- 对用户完全透明，远大于实际内存，取决于系统位数
- 特性：多次，对换，虚拟
- 缺页中断：属于系统异常
- 页面置换算法
  - 最佳置换 OPT：存在于理论，多用于比较其他算法优劣
  - 先来先置换 FIFO：可能有Belady异常
  - 最近最久未使用 LRU：堆栈类，使用寄存器
  - Clock算法/NRU算法：指针循环扫描，考虑指针初始位置
  - 改进Clock：考虑页面修改
  - 驻留集算法
- 页面分配策略
  - 固定or可变置换：每个进程分配物理块数目固定or可变
  - 全局or局部置换：置换发生在程序自身物理快内or所有程序内，不存在固定分配全局置换
- 带虚拟存储的内存分配：请求页式存储，请求段式存储，请求段页式存储
- 颠簸现象：即抖动

# 文件管理
- 文件控制块 FCB，File Control B？？
- 文件目录系统
## 用户角度
- 用户进行输入输出，以文件为基本单位
- 文件组成：一块存储空间 + 其中数据，分类 + 索引信息，访问权限信息
- 文件结构：数据项-最低级的数据组织形式，记录-相关数据项集合
- 逻辑结构：无结构-流文件，有结构 =｛顺序结构文件，索引文件，索引顺序文件，散列文件｝
- 文件操作-系统调用
  - 创建Create：申请目录项创建FCB，申请磁盘块
  - 打开Open：返回文件描述符，文件信息填入打开文件表
  - 指针定位Seek：为后续读写操作服务
  - 读Read，写Write，文件重定位，删除，复杂组合操作
- 文件分类：普通文件，特殊文件，目录文件，管道文件，套接字等
- 文件目录
  - 实现：线性链表，哈希表
  - 结构组成
    - 文件目录项：文件控制块FCB，索引节点 + i节点
    - 文件目录：属于目录文件，目录项对应的集合
  - 执行方式
    - 找到 指定目录FCB →下级目录FCB →指定文件FCB
    - 找到 索引节点 →对应i节点 →...
  - 目录类型：与访盘次数结合考虑
    - 单级目录-无法实现多用户&文件不可重名，多级目录，树形目录-使用最普遍，环形目录-实现文件共享
- 文件访问：相对路径，绝对路径
- 文件共享：与共享文件的增删结合考虑
  - 软链接-基于符号链-Link文件，硬链接-基于索引节点
- 文件保护：口令保护，密码保护，访问控制-rwx指令类型
- 文件系统备份：增量备份-备份快恢复慢，全量备份-备份慢恢复快
## 操作系统角度
- 层次结构：用户调用接口 →文件目录系统 →存取控制验证 →逻辑文件系统+文件信息缓冲区 →物理文件系统 →分配模块 →设备管理程序模块
- 文件分配
  - 连续分配
  - 链接分配：隐式链接，显式链接-FAT表
  - 索引分配：直接索引，单级索引，多级索引，多级混合索引-UNIX中三级索引结构+分析文件大小计算
- 文件存储空间管理
  - 空间划分：内存 + 磁盘
  - 磁盘部分
    - 磁盘分区-物理，文件卷-逻辑，格式化，目录文件，用户文件
    - 引导区：UFS引导块，NTFS分区引导扇区，位于启动磁盘or系统盘中，用于引导系统
    - 卷，分区信息：UFS超级块，NTFS主控文件表，用于所在文件卷的管理
  - 内存部分：所有安装分区的信息，系统打开文件表，单个进程打开文件表
  - 管理方式：空闲表法，空闲链表法，位视图？位示图？法，成组链接法
- 物理存储
  - 磁盘读写结构：磁头-磁道，柱面，扇区
  - 磁盘读写操作：寻道时间，延迟时间，传输时间
  - 磁盘调度算法
- 磁盘调度算法
  - 先来先服务 FCFS
  - 最短寻找时间优先 SSTF
  - SCAN
  - C-SCAN
  - 旋转调度算法：考虑处理时延，同磁头不同扇区，不同磁头相同编号扇区，不同磁头不同编号扇区
- 个人OS的文件系统
  - Windows：FAT32，支持Unicode-两字节表示一个字符，支持长文件名格式，多个目录项
  - UNIX：UNIX V，UNIX三级混合文件索引，FCB拆分为索引目录项 + i节点

# 输入/输出管理(I/O)
- IO设备分类
  - 按使用特性：人机交互类，存储设备，网络通信设备
  - 按传输速率：低速，中速，高速
  - 按信息交换的单位：块设备，字符设备
- IO控制方式
  - 程序直接控制：CUP始终占用
  - 中断驱动方式：每传输完成一个字符，CPU占用一次
  - DMA方式：开始时、结束时 CPU占用
  - 通道控制方式：自主权更高
- IO系统层次结构
  - 用户层IO软件：服务于用户
  - 设备独立性软件：设备无关性，映射逻辑设备与物理设备
  - 设备驱动程序：为IO系统隐藏设备控制器之间的差异
  - 中断处理程序：进程上下文切换
  - 硬件设备：电子部分-设备控制器即适配器，机械部分
- IO编址：IO独立编址，占用内存编址
- IO进程：专门处理OS中的IO中断与IO请求
- 设备分配
  - 相关数据结构
    - 设备控制表DCT，控制器控制表COCT，通道控制表CHCT，系统设备表SDT
    - DCT COCT 一一对应，CHCT 一对多个 COCT，一个系统中只有一个SDT
  - 主要考虑因素：设备固有属性，分配算法，分配安全性，独立性
  - 策略：静态分配-用于独占设备，动态分配-可能死锁，相关算法-先请求先分配、优先级分配
  - 安全性：安全分配方式-CPU、IO串行工作-效率低，不安全分配-可能死锁
- Spooling技术：空间换时间
  - 意义：提高IO总体速度，将独占设备改为共享，实现虚拟设备，缓和CPU高速与IO低速的矛盾
- IO性能相关
  - 缓冲技术-缓冲区：单缓冲区，双缓冲区，循环缓冲区，缓冲池-生产者消费者问题
  - 高速缓存技术：利用局部性原理，关联LRU算法
  - 异步IO
  - 异步传输技术
  - 信息优化分布
  - RAID技术：RAID 0条带化，RAID 1镜像，RAID 4交错块奇偶校验
## 核心子系统
- 高速缓存
- 缓冲区
